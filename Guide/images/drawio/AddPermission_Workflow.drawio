<mxfile host="app.diagrams.net">
  <diagram id="AddPermissionWorkflow" name="Add Single Permission Workflow">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- User Action -->
        <mxCell id="user-1" value="User clicks&#xa;'Add Permission'" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="40" y="40" width="140" height="60" as="geometry" />
        </mxCell>
        
        <!-- Form Display -->
        <mxCell id="form" value="Show Permission Form&#xa;• Select DataSet&#xa;• Select User/Group&#xa;• Select Field&#xa;• Enter RLS Values" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;" vertex="1" parent="1">
          <mxGeometry x="20" y="140" width="180" height="110" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow1" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="user-1" target="form">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Validation -->
        <mxCell id="validate" value="Validate Input&#xa;• DataSet exists?&#xa;• User/Group exists?&#xa;• Field exists?&#xa;• Values not empty?" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;" vertex="1" parent="1">
          <mxGeometry x="20" y="290" width="180" height="110" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow2" value="Submit" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="form" target="validate">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Decision: Valid? -->
        <mxCell id="decision1" value="Input&#xa;Valid?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="50" y="440" width="120" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow3" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="validate" target="decision1">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Error Path -->
        <mxCell id="error1" value="ERROR:&#xa;Show validation&#xa;errors" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="250" y="450" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow-error1" value="No" style="endArrow=classic;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;" edge="1" parent="1" source="decision1" target="error1">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Retry Arrow -->
        <mxCell id="retry1" value="Fix &amp; Retry" style="endArrow=classic;html=1;exitX=0.5;exitY=0;entryX=1;entryY=0.5;rounded=1;dashed=1;" edge="1" parent="1" source="error1" target="form">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Check Duplicate -->
        <mxCell id="check-dup" value="Check if Permission&#xa;Already Exists&#xa;(DataSet + User + Field)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="20" y="560" width="180" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow4" value="Yes" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="decision1" target="check-dup">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Decision: Duplicate? -->
        <mxCell id="decision2" value="Already&#xa;Exists?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="50" y="680" width="120" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow5" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="check-dup" target="decision2">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Warning Duplicate -->
        <mxCell id="warning-dup" value="WARNING:&#xa;Permission exists&#xa;Use Edit instead" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="250" y="690" width="130" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow-warning" value="Yes" style="endArrow=classic;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;" edge="1" parent="1" source="decision2" target="warning-dup">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Continue to next column -->
        <mxCell id="connector1" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0;entryY=0.5;rounded=1;" edge="1" parent="1" source="decision2" target="step1">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Step 1: Save to DynamoDB -->
        <mxCell id="step1" value="Save to DynamoDB&#xa;Insert new Permission&#xa;record" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="480" y="40" width="160" height="70" as="geometry" />
        </mxCell>
        
        <!-- Decision: Save Success? -->
        <mxCell id="decision3" value="Saved?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="500" y="150" width="120" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow6" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="step1" target="decision3">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Error Save -->
        <mxCell id="error-save" value="ERROR:&#xa;Database error" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="700" y="160" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow-error-save" value="No" style="endArrow=classic;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;" edge="1" parent="1" source="decision3" target="error-save">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Decision: Auto-Publish? -->
        <mxCell id="decision4" value="Auto-Publish&#xa;Enabled?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="500" y="270" width="120" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow7" value="Yes" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="decision3" target="decision4">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Manual Publish Path -->
        <mxCell id="manual" value="Show Success&#xa;'Permission added&#xa;Click Publish to apply'" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="700" y="280" width="150" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow-manual" value="No" style="endArrow=classic;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;" edge="1" parent="1" source="decision4" target="manual">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Step 2: Trigger Publish -->
        <mxCell id="step2" value="Trigger Publish RLS&#xa;Workflow&#xa;(Background)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="480" y="390" width="160" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow8" value="Yes" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="decision4" target="step2">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Info Box -->
        <mxCell id="info-publish" value="Runs full Publish RLS:&#xa;• Generate CSV&#xa;• Upload to S3&#xa;• Update Glue&#xa;• Update QS DataSet&#xa;• Check Ingestion" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;" vertex="1" parent="1">
          <mxGeometry x="480" y="500" width="160" height="110" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow9" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="step2" target="info-publish">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Success -->
        <mxCell id="success" value="SUCCESS!&#xa;Permission Added&#xa;&amp; Published" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="485" y="650" width="150" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow-success" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="info-publish" target="success">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Legend -->
        <mxCell id="legend-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#666666;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="900" y="40" width="180" height="200" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-title" value="Legend" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="900" y="40" width="180" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-1" value="Lambda Function" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="910" y="80" width="160" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-2" value="Decision Point" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="950" y="115" width="80" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-3" value="Error State" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="910" y="165" width="160" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-4" value="User Input" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="910" y="200" width="160" height="25" as="geometry" />
        </mxCell>
        
        <!-- Notes -->
        <mxCell id="notes-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="900" y="260" width="180" height="240" as="geometry" />
        </mxCell>
        
        <mxCell id="notes-title" value="Notes:" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="910" y="270" width="160" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="notes-text" value="• Permission defines:&#xa;  DataSet + User/Group&#xa;  + Field + RLS Values&#xa;&#xa;• Validates all inputs&#xa;  before saving&#xa;&#xa;• Checks for duplicates&#xa;&#xa;• Can auto-publish or&#xa;  require manual publish&#xa;&#xa;• Auto-publish runs&#xa;  full RLS workflow&#xa;&#xa;• Multiple permissions&#xa;  can be added before&#xa;  publishing&#xa;&#xa;• RLS values are&#xa;  comma-separated" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="910" y="295" width="160" height="195" as="geometry" />
        </mxCell>
        
        <!-- Example -->
        <mxCell id="example-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="900" y="520" width="180" height="160" as="geometry" />
        </mxCell>
        
        <mxCell id="example-title" value="Example:" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="910" y="530" width="160" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="example-text" value="DataSet: Sales_Data&#xa;User: john@example.com&#xa;Field: Region&#xa;Values: US-East, US-West&#xa;&#xa;Result: John can only&#xa;see sales data for&#xa;US-East and US-West&#xa;regions" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="910" y="555" width="160" height="115" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
