<mxfile host="app.diagrams.net">
  <diagram id="BulkImportWorkflow" name="Bulk Permission Import Workflow">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- User Action -->
        <mxCell id="user-1" value="User clicks&#xa;'Import Permissions'" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="40" y="40" width="160" height="60" as="geometry" />
        </mxCell>
        
        <!-- File Upload -->
        <mxCell id="upload" value="Upload CSV File&#xa;Show file picker" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="40" y="140" width="160" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow1" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="user-1" target="upload">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Decision: File Selected? -->
        <mxCell id="decision1" value="File&#xa;Selected?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="60" y="240" width="120" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow2" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="upload" target="decision1">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Cancel Path -->
        <mxCell id="cancel" value="Operation&#xa;Cancelled" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="260" y="250" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow-cancel" value="No" style="endArrow=classic;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;" edge="1" parent="1" source="decision1" target="cancel">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Parse CSV -->
        <mxCell id="parse" value="Parse CSV File&#xa;Read headers &amp; rows" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="40" y="360" width="160" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow3" value="Yes" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="decision1" target="parse">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Decision: Parse Success? -->
        <mxCell id="decision2" value="Valid&#xa;CSV?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="60" y="460" width="120" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow4" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="parse" target="decision2">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Error Parse -->
        <mxCell id="error-parse" value="ERROR:&#xa;Invalid CSV format&#xa;or encoding" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="260" y="470" width="130" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow-error-parse" value="No" style="endArrow=classic;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;" edge="1" parent="1" source="decision2" target="error-parse">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Validate Headers -->
        <mxCell id="validate-headers" value="Validate Headers&#xa;Required columns:&#xa;• DataSet&#xa;• UserGroup&#xa;• Field&#xa;• RLSValues" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;" vertex="1" parent="1">
          <mxGeometry x="30" y="580" width="180" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow5" value="Yes" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="decision2" target="validate-headers">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Decision: Headers Valid? -->
        <mxCell id="decision3" value="Headers&#xa;Valid?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="60" y="720" width="120" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow6" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="validate-headers" target="decision3">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Error Headers -->
        <mxCell id="error-headers" value="ERROR:&#xa;Missing required&#xa;columns" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="260" y="730" width="130" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow-error-headers" value="No" style="endArrow=classic;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;" edge="1" parent="1" source="decision3" target="error-headers">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Continue to next column -->
        <mxCell id="connector1" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0;entryY=0.5;rounded=1;" edge="1" parent="1" source="decision3" target="validate-rows">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Validate Rows -->
        <mxCell id="validate-rows" value="Validate Each Row&#xa;• DataSet exists?&#xa;• User/Group exists?&#xa;• Field exists in DataSet?&#xa;• Values not empty?&#xa;• Check duplicates" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;" vertex="1" parent="1">
          <mxGeometry x="480" y="40" width="180" height="120" as="geometry" />
        </mxCell>
        
        <!-- Row Loop -->
        <mxCell id="loop-rows" value="For each row" style="endArrow=classic;html=1;exitX=1;exitY=0.5;entryX=1;entryY=0.5;rounded=1;dashed=1;" edge="1" parent="1" source="validate-rows" target="validate-rows">
          <mxGeometry x="-0.2" width="50" height="50" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        
        <!-- Show Preview -->
        <mxCell id="preview" value="Show Preview Table&#xa;• Valid rows (green)&#xa;• Invalid rows (red)&#xa;• Error messages&#xa;• Row count summary" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;" vertex="1" parent="1">
          <mxGeometry x="480" y="200" width="180" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow7" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="validate-rows" target="preview">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Decision: Any Valid Rows? -->
        <mxCell id="decision4" value="Valid&#xa;Rows?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="510" y="340" width="120" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow8" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="preview" target="decision4">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Error No Valid -->
        <mxCell id="error-no-valid" value="ERROR:&#xa;No valid rows&#xa;to import" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="710" y="350" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow-error-valid" value="No" style="endArrow=classic;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;" edge="1" parent="1" source="decision4" target="error-no-valid">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- User Confirmation -->
        <mxCell id="confirm" value="User Reviews &amp; Confirms&#xa;'Import X valid rows?'" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="490" y="460" width="160" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow9" value="Yes" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="decision4" target="confirm">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Decision: Confirmed? -->
        <mxCell id="decision5" value="User&#xa;Confirms?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="510" y="560" width="120" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow10" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="confirm" target="decision5">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Cancel Import -->
        <mxCell id="cancel-import" value="Import&#xa;Cancelled" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="710" y="570" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow-cancel-import" value="No" style="endArrow=classic;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;" edge="1" parent="1" source="decision5" target="cancel-import">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Save to DB -->
        <mxCell id="save-db" value="Save to DynamoDB&#xa;Insert valid permissions&#xa;(batch operation)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="490" y="680" width="160" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow11" value="Yes" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="decision5" target="save-db">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Trigger Publish -->
        <mxCell id="publish" value="Trigger Publish RLS&#xa;(if auto-publish enabled)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="490" y="790" width="160" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow12" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="save-db" target="publish">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Success -->
        <mxCell id="success" value="SUCCESS!&#xa;X Permissions Imported&#xa;Y Skipped (errors)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="260" y="800" width="160" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow-success" value="" style="endArrow=classic;html=1;exitX=0;exitY=0.5;entryX=1;entryY=0.5;rounded=1;" edge="1" parent="1" source="publish" target="success">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Legend -->
        <mxCell id="legend-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#666666;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="880" y="40" width="180" height="200" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-title" value="Legend" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="880" y="40" width="180" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-1" value="Lambda Function" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="890" y="80" width="160" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-2" value="Decision Point" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="930" y="115" width="80" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-3" value="Error State" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="890" y="165" width="160" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-4" value="User Input" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="890" y="200" width="160" height="25" as="geometry" />
        </mxCell>
        
        <!-- Notes -->
        <mxCell id="notes-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="880" y="260" width="180" height="260" as="geometry" />
        </mxCell>
        
        <mxCell id="notes-title" value="Notes:" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="890" y="270" width="160" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="notes-text" value="• CSV must be UTF-8&#xa;&#xa;• Required columns:&#xa;  DataSet, UserGroup,&#xa;  Field, RLSValues&#xa;&#xa;• Validates each row&#xa;  before import&#xa;&#xa;• Shows preview with&#xa;  validation results&#xa;&#xa;• Only valid rows are&#xa;  imported&#xa;&#xa;• Invalid rows are&#xa;  skipped with errors&#xa;&#xa;• Batch operation for&#xa;  performance&#xa;&#xa;• Can import 100s of&#xa;  permissions at once&#xa;&#xa;• Triggers single&#xa;  publish for all" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="890" y="295" width="160" height="215" as="geometry" />
        </mxCell>
        
        <!-- CSV Format -->
        <mxCell id="format-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="880" y="540" width="180" height="180" as="geometry" />
        </mxCell>
        
        <mxCell id="format-title" value="CSV Format:" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="890" y="550" width="160" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="format-text" value="DataSet,UserGroup,&#xa;Field,RLSValues&#xa;&#xa;Sales_Data,&#xa;john@example.com,&#xa;Region,&#xa;&quot;US-East,US-West&quot;&#xa;&#xa;Sales_Data,&#xa;GroupSales,&#xa;Country,&#xa;&quot;USA,Canada&quot;&#xa;&#xa;Note: Use quotes for&#xa;comma-separated values" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=9;fontFamily=Courier New;" vertex="1" parent="1">
          <mxGeometry x="890" y="575" width="160" height="135" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
