<mxfile host="app.diagrams.net">
  <diagram id="FetchFieldsWorkflow" name="Fetch DataSet Fields Workflow">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- User Action -->
        <mxCell id="user-1" value="User opens&#xa;'Add Permission' Form" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="40" y="40" width="180" height="60" as="geometry" />
        </mxCell>
        
        <!-- Select DataSet -->
        <mxCell id="select-ds" value="User Selects DataSet&#xa;from dropdown" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="140" width="160" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow1" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="user-1" target="select-ds">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Check Cache -->
        <mxCell id="check-cache" value="Check Local Cache&#xa;Fields already loaded?" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="50" y="240" width="160" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow2" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="select-ds" target="check-cache">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Decision: Cached? -->
        <mxCell id="decision1" value="Fields&#xa;Cached?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="70" y="340" width="120" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow3" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="check-cache" target="decision1">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Use Cache Path -->
        <mxCell id="use-cache" value="Use Cached Fields&#xa;(Fast response)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="270" y="350" width="130" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow-cache" value="Yes" style="endArrow=classic;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;" edge="1" parent="1" source="decision1" target="use-cache">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Show Loading -->
        <mxCell id="loading" value="Show Loading Indicator&#xa;'Fetching fields...'" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="50" y="460" width="160" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow4" value="No" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="decision1" target="loading">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Fetch from QS -->
        <mxCell id="fetch-qs" value="fetchDataSetFieldsFromQS&#xa;Query QuickSight API&#xa;for DataSet schema" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="40" y="560" width="180" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow5" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="loading" target="fetch-qs">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Decision: Fetch Success? -->
        <mxCell id="decision2" value="Fields&#xa;Retrieved?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="70" y="670" width="120" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow6" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="fetch-qs" target="decision2">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Error Path -->
        <mxCell id="error1" value="ERROR:&#xa;Failed to fetch fields&#xa;DataSet not found&#xa;or no access" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="270" y="675" width="140" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow-error" value="No" style="endArrow=classic;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;" edge="1" parent="1" source="decision2" target="error1">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Continue to next column -->
        <mxCell id="connector1" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0;entryY=0.5;rounded=1;" edge="1" parent="1" source="decision2" target="parse">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Parse Fields -->
        <mxCell id="parse" value="Parse Field List&#xa;Extract:&#xa;• Field name&#xa;• Data type&#xa;• Description" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;" vertex="1" parent="1">
          <mxGeometry x="480" y="40" width="160" height="90" as="geometry" />
        </mxCell>
        
        <!-- Filter Fields -->
        <mxCell id="filter" value="Filter Fields&#xa;• Exclude system fields&#xa;• Exclude calculated fields&#xa;  (optional)&#xa;• Sort alphabetically" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;" vertex="1" parent="1">
          <mxGeometry x="480" y="170" width="160" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow7" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="parse" target="filter">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Cache Fields -->
        <mxCell id="cache" value="Cache Fields Locally&#xa;Store for 5 minutes&#xa;(avoid repeated API calls)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="480" y="310" width="160" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow8" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="filter" target="cache">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Merge with Cache Path -->
        <mxCell id="merge" value="" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#666666;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="545" y="430" width="30" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow9" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="cache" target="merge">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow-merge" value="" style="endArrow=classic;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;rounded=1;" edge="1" parent="1" source="use-cache" target="merge">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Populate Dropdown -->
        <mxCell id="populate" value="Populate Field Dropdown&#xa;Enable field selection" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="480" y="500" width="160" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow10" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="merge" target="populate">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Hide Loading -->
        <mxCell id="hide-loading" value="Hide Loading Indicator&#xa;Show field dropdown" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="480" y="600" width="160" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow11" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="populate" target="hide-loading">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Success -->
        <mxCell id="success" value="SUCCESS!&#xa;User Can Select Field" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="490" y="700" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="arrow-success" value="" style="endArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="hide-loading" target="success">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Legend -->
        <mxCell id="legend-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#666666;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="880" y="40" width="180" height="200" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-title" value="Legend" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="880" y="40" width="180" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-1" value="Lambda Function" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="890" y="80" width="160" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-2" value="Decision Point" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="930" y="115" width="80" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-3" value="Error State" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="890" y="165" width="160" height="25" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-4" value="UI Update" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="890" y="200" width="160" height="25" as="geometry" />
        </mxCell>
        
        <!-- Notes -->
        <mxCell id="notes-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="880" y="260" width="180" height="260" as="geometry" />
        </mxCell>
        
        <mxCell id="notes-title" value="Notes:" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="890" y="270" width="160" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="notes-text" value="• Triggered when user&#xa;  selects a DataSet&#xa;&#xa;• Uses local cache to&#xa;  avoid repeated API calls&#xa;&#xa;• Cache expires after&#xa;  5 minutes&#xa;&#xa;• Shows loading indicator&#xa;  during fetch&#xa;&#xa;• Filters out system&#xa;  fields (optional)&#xa;&#xa;• Sorts fields&#xa;  alphabetically&#xa;&#xa;• Essential for:&#xa;  - Add Permission form&#xa;  - Edit Permission form&#xa;  - DataSet details view&#xa;&#xa;• Fast UX with caching" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="890" y="295" width="160" height="215" as="geometry" />
        </mxCell>
        
        <!-- Field Types -->
        <mxCell id="types-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="880" y="540" width="180" height="160" as="geometry" />
        </mxCell>
        
        <mxCell id="types-title" value="Field Information:" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="890" y="550" width="160" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="types-text" value="Each field includes:&#xa;&#xa;• Name (display)&#xa;• ID (internal)&#xa;• Data Type:&#xa;  - STRING&#xa;  - INTEGER&#xa;  - DECIMAL&#xa;  - DATETIME&#xa;  - BOOLEAN&#xa;• Description (optional)&#xa;&#xa;Used for RLS filtering" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="890" y="575" width="160" height="115" as="geometry" />
        </mxCell>
        
        <!-- Performance -->
        <mxCell id="perf-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="270" y="40" width="140" height="120" as="geometry" />
        </mxCell>
        
        <mxCell id="perf-title" value="Performance:" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="280" y="50" width="120" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="perf-text" value="• Cached: ~10ms&#xa;• API call: ~500ms&#xa;&#xa;Cache reduces:&#xa;• API costs&#xa;• Response time&#xa;• QuickSight load&#xa;&#xa;Improves UX!" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="280" y="75" width="120" height="75" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
